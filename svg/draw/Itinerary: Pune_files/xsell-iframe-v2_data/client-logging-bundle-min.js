var dctk=window.dctk||{};dctk.logging=dctk.logging||{};(function(){if(dctk._loggingLoaded){setTimeout(function(){throw new Error("Client Logging is already loaded")})}dctk._loggingLoaded=true;(function(){if(dctk.logging.enabled==null){dctk.logging.enabled=true}if(!dctk.logging.enabled){return}var l="/cl/1x1.gif",v="/cl/2x2.gif",z={},C=[];var j=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}];var e=[{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.userAgent,subString:"Kindle",identity:"Kindle"},{string:navigator.userAgent,subString:"BB10",identity:"Blackberry"},{string:navigator.userAgent,subString:"Touch",addlString:"MSIE 10",identity:"Surface"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}];var p;dctk.logging.setProduction=function(i){p=i};dctk.logging._isProduction=function(){return p!=null?p:this._isAProductionDomain()};var r=["www.expedia.com","www.expedia.co.uk","www.expedia.ca","www.expedia.de","www.expedia.it","www.expedia.es","www.expedia.nl","www.expedia.mx","www.expedia.com.sg","www.expedia.com.my","www.expedia.co.kr","www.expedia.co.th","www.expedia.com.hk","www.expedia.fr","www.expedia.com.au","www.expedia.co.in","www.expedia.co.jp","www.expedia.co.nz","www.expedia.co.id","www.expedia.com.tw","www.expedia.ie","www.expedia.be","www.expedia.se","www.expedia.no","www.expedia.dk","www.expedia.com.ph","www.expedia.com.br","www.expedia.com.ar","www.expedia.com.vn","www.expedia.fi","www.expedia.at","expedia.viaggi.virgilio.it","expedia.viaggi.tiscali.it","expedia.corriere.it","expedia.viaggi.deejay.it","expedia.allmusic.tv","voyages.anyway.com","yahoo.expedia.com.au","ninemsn.expedia.com.au","jal.expedia.co.jp","msn.expedia.co.jp","expedia-aarp.com","voyage-sncf.com","expediafortd.com","vacation.hotwire.com","www.travelocity.com","www.travelocity.ca","xsell.expedia.com","www.airasiago.com.my",/(^|\.)wotif\.(com|co\.nz)$/];dctk.logging._isAProductionDomain=function(F){F=F||{};F._domain=F._domain||D;F._productionDomains=F._productionDomains||r;for(var E=0;E<F._productionDomains.length;E++){if(F._domain.match(F._productionDomains[E])){return true}}return false};var n=function(H){for(var E=0;E<H.length;E++){var F=H[E].string;var G=H[E].prop;dctk.logging.versionSearchString=H[E].versionSearch||H[E].identity;if(F){if(F.indexOf(H[E].subString)!=-1&&(!H[E].addlString||F.indexOf(H[E].addlString)!=-1)){return H[E].identity||"unknown"}}else{if(G){return H[E].identity||"unknown"}}}};var t=function(E){var i=E.indexOf(dctk.logging.versionSearchString);if(i==-1){return}return parseFloat(E.substring(i+dctk.logging.versionSearchString.length+1))};var k=function(i){if(i.toISOString){return i.toISOString()}else{return i.getFullYear().toString()+"-"+i.getMonth()+"-"+i.getDate()+"T"+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()}};var q=function(F,J){var E=false,I=true,L=F.document,K=L.documentElement,O=L.addEventListener?"addEventListener":"attachEvent",M=L.addEventListener?"removeEventListener":"detachEvent",i=L.addEventListener?"":"on",N=function(P){if(P.type=="readystatechange"&&L.readyState!="complete"){return}(P.type=="load"?F:L)[M](i+P.type,N,false);if(!E&&(E=true)){J.call(F,P.type||P)}},H=function(){try{K.doScroll("left")}catch(P){setTimeout(H,50);return}N("poll")};if(L.readyState=="complete"){J.call(F,"lazy")}else{if(L.createEventObject&&K.doScroll){try{I=!F.frameElement}catch(G){}if(I){H()}}L[O](i+"DOMContentLoaded",N,false);L[O](i+"readystatechange",N,false);F[O](i+"load",N,false)}};var w=function(F,E,i){if(F.attachEvent){F["e"+E+i]=i;F[E+i]=function(){F["e"+E+i](window.event)};F.attachEvent("on"+E,F[E+i])}else{F.addEventListener(E,i,false)}};var A=function(E){var i=new Image();i.src=l+c+"&pageName="+dctk.logging.pageName+"&guid="+g()+"&logTime="+k(new Date())+"&action=logTrxEvent&"+E.join("&");a.push(i)};var g=function(){return dctk.logging.guid||"unknown"};var h=function(E){var i=new Image();i.src=v+c+"&pageName="+dctk.logging.pageName+"&guid="+g()+"&logTime="+k(new Date())+"&action=logErrors&"+E.join("&");a.push(i)};var u=function(i){return window.performance&&performance.timing&&performance.timing[i]||NaN};var s=function(){return{unloadTime:u("unloadEventEnd")-u("unloadEventStart"),redirectTime:u("redirectEnd")-u("redirectStart"),dnsTime:u("domainLookupEnd")-u("domainLookupStart"),connectionTime:u("connectEnd")-u("connectStart"),requestTime:u("responseStart")-u("requestStart"),responseTime:u("responseEnd")-u("responseStart"),parsingTime:u("domInteractive")-u("domLoading"),domReadyCallbackTime:u("domContentLoadedEventEnd")-u("domContentLoadedEventStart"),onLdCallbackTime:u("loadEventEnd")-u("loadEventStart"),processingTime:u("domComplete")-u("domLoading"),navigationToResponse:u("responseStart")-u("navigationStart"),navigationToDomContentLoaded:u("domContentLoadedEventStart")-u("navigationStart"),navigationToOnLd:u("loadEventStart")-u("navigationStart"),fetchToResponse:u("responseStart")-u("fetchStart"),fetchToDomContentLoaded:u("domContentLoadedEventStart")-u("fetchStart"),fetchToOnLd:u("loadEventStart")-u("fetchStart"),responseToDomContentLoaded:u("domContentLoadedEventStart")-u("responseStart"),responseToOnLd:u("loadEventStart")-u("responseStart"),navigationToDomInteractive:u("domInteractive")-u("navigationStart")}};var m=function(E){if(!("responseToOnLd" in E)){return}var G=[];for(var i in E){var F=E[i];if(isNaN(F)){continue}G.push(i+"="+F)}if(!G.length){return}dctk.logging.logTrxEvent("navTiming",G.join("&"))};var B=n(j);var f=t(navigator.userAgent)||t(navigator.appVersion)||"an unknown version";var D=window.location.hostname;var d=n(e);var b="";var y=[];if(dctk.logging.data){for(var x=0,o=dctk.logging.data.split("|");x<o.length&&o[x].length>0;x++){b+="&"+o[x]}}var a=[],c="?browser="+B+"&browserVersion="+f+"&platform="+d+"&domain="+D+"&live="+dctk.logging._isProduction()+b;if("performance" in window){w(window,"load",function(){window.setTimeout(function(){dctk.logging.navTiming=s();m(dctk.logging.navTiming)},1000)});dctk.logging.pageStartTime=window.performance.timing.responseStart}else{dctk.logging.pageStartTime=dctk.logging.pageStartTime||new Date().getTime();w(window,"load",function(){var i=y.concat(["responseToOnLd="+(new Date().getTime()-dctk.logging.pageStartTime)]);A(i)});q(window,function(){y=["responseToDomContentLoaded="+(new Date().getTime()-dctk.logging.pageStartTime)]})}dctk.logging.navTiming={};dctk.logging.browser=B;dctk.logging.version=f;dctk.logging.OS=d;dctk.logging.logTrxEvent=function(i,E){var F=[i+"_elapsedTime="+(new Date().getTime()-dctk.logging.pageStartTime)];if(E){F=F.concat(E)}A(F)};dctk.logging.trxEventWrapper=function(F,i,E){return function(){var I=new Date().getTime();var G=F.apply((E?E:this),arguments);var H=new Date().getTime();A([i+"_elapsedTime="+(H-dctk.logging.pageStartTime),"clEventName01="+i,"clEventTime01="+(H-I)]);return G}};dctk.logging.logMessage=function(i,E){var G=[].concat(this._normalizeMessageParams((function(){var H={label:i};H[i+"_elapsedTime"]=new Date().getTime()-dctk.logging.pageStartTime;return H})())).concat(this._normalizeMessageParams(E));if(i==="windowOnError"){var F=E.onErrorMsg;if(!(F in z)){z[F]={count:0};h(G)}z[F].count=parseInt(z[F].count,10)+1;if(z[F].count===100){h(G.concat("exceedsErrorThreshold=true"))}}else{h(G)}};dctk.logging.normalizeError=function(H){var E="NA",F=E,i=E,J=E,I;try{if(H&&H.stack){I=H.stack.match(/\(([^\)]+\d+)\)/);if(!I){I=H.stack.match(/@([^\)]+\d+)\n/)}if(I){I=I[1].split(":");F=I.pop();i=I.pop();J=I.join(":")}}}catch(G){}if(H){H={sourceURL:H.sourceURL||H.fileName||J,line:H.line||H.lineNumber||i,col:H.columnNumber||F,message:H.message,stack:H.stack||E}}return H};dctk.logging.logError=function(G,E,i){if(!G||!E){return}var F=[];if("[object Array]"===Object.prototype.toString.call(i)){F.concat(i)}E=this.normalizeError(E);if(E){F.push("onErrorMsg="+E.message);F.push("onErrorLine="+E.line);F.push("onErrorChar="+E.col);F.push("onErrorUrl="+encodeURIComponent(E.sourceURL));if(E.stack){F.push("stack="+encodeURIComponent(E.stack.substr(0,200)))}}else{F.push("onError=NA")}F.push("pageUrl="+encodeURIComponent(window.location.href));F.push("clientWidth="+document.documentElement.clientWidth);if(window.console){if(typeof console.error==="function"){console.error(G+": "+F.join("|"))}else{if(typeof console.log==="function"){console.log(G+": "+F.join("|"))}}}dctk.logging.logMessage(G,F)};dctk.logging.reset=function(){dctk.logging.pageStartTime=new Date().getTime()};dctk.logging.subscribeToOnerrorCallback=function(i){C.push(i)};dctk.logging.publishOnerrorCallback=function(){for(var E=0;E<C.length;E++){if(typeof C[E]==="function"){C[E]()}}};dctk.logging.setPageName=function(i){dctk.logging.pageName=i};dctk.logging._originalOnError=window.onerror;window.onerror=function(G,E,i){if(dctk.logging._originalOnError){if(String(dctk.logging._originalOnError)!==String(window.onerror)){dctk.logging._originalOnError.apply(window,arguments)}}var F=0;if(document.documentElement){F=document.documentElement.clientWidth}dctk.logging.logMessage("windowOnError",{onErrorMsg:G.replace(/\'/ig,"`"),onErrorUrl:E,onErrorLine:i,clientWidth:F});dctk.logging.publishOnerrorCallback()};dctk.loggingAdapter=dctk.logging;dctk.logging._normalizeMessageParams=function(E){if(!E){return[]}if(typeof E=="string"){return[E]}if(!(E instanceof Array)){var F=[];for(var i in E){F.push(encodeURIComponent(i)+"="+encodeURIComponent(E[i]))}E=F}return E}})();if(typeof define=="function"&&define.amd){define("dctk/clientLogging",function(){return dctk.logging})}})();